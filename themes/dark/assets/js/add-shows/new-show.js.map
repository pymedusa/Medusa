{"version":3,"names":[],"mappings":"","sources":["js/add-shows/new-show.js"],"sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){\nMEDUSA.addShows.newShow = function () {\n    function updateSampleText() {\n        // If something's selected then we have some behavior to figure out\n\n        let showName;\n        let sepChar;\n        // If they've picked a radio button then use that\n        if ($('input:radio[name=whichSeries]:checked').length !== 0) {\n            showName = $('input:radio[name=whichSeries]:checked').val().split('|')[4];\n        } else if ($('input:hidden[name=whichSeries]').length !== 0 && $('input:hidden[name=whichSeries]').val().length !== 0) {\n            // If we provided a show in the hidden field, use that\n            showName = $('#providedName').val();\n        } else {\n            showName = '';\n        }\n        $.updateBlackWhiteList(showName);\n        let sampleText = 'Adding show <b>' + showName + '</b> into <b>';\n\n        // If we have a root dir selected, figure out the path\n        if ($('#rootDirs option:selected').length !== 0) {\n            let rootDirectoryText = $('#rootDirs option:selected').val();\n            if (rootDirectoryText.indexOf('/') >= 0) {\n                sepChar = '/';\n            } else if (rootDirectoryText.indexOf('\\\\') >= 0) {\n                sepChar = '\\\\';\n            } else {\n                sepChar = '';\n            }\n\n            if (rootDirectoryText.substr(sampleText.length - 1) !== sepChar) {\n                rootDirectoryText += sepChar;\n            }\n            rootDirectoryText += '<i>||</i>' + sepChar;\n\n            sampleText += rootDirectoryText;\n        } else if ($('#fullShowPath').length !== 0 && $('#fullShowPath').val().length !== 0) {\n            sampleText += $('#fullShowPath').val();\n        } else {\n            sampleText += 'unknown dir.';\n        }\n\n        sampleText += '</b>';\n\n        // If we have a show name then sanitize and use it for the dir name\n        if (showName.length > 0) {\n            $.get('addShows/sanitizeFileName', {\n                name: showName\n            }, data => {\n                $('#displayText').html(sampleText.replace('||', data));\n            });\n            // If not then it's unknown\n        } else {\n            $('#displayText').html(sampleText.replace('||', '??'));\n        }\n\n        // Also toggle the add show button\n        if (($('#rootDirs option:selected').length !== 0 || $('#fullShowPath').length !== 0 && $('#fullShowPath').val().length !== 0) && // eslint-disable-line no-mixed-operators\n        $('input:radio[name=whichSeries]:checked').length !== 0 || // eslint-disable-line no-mixed-operators\n        $('input:hidden[name=whichSeries]').length !== 0 && $('input:hidden[name=whichSeries]').val().length !== 0) {\n            $('#addShowButton').prop('disabled', false);\n        } else {\n            $('#addShowButton').prop('disabled', true);\n        }\n    }\n\n    let searchRequestXhr = null;\n    function searchIndexers() {\n        if ($('#nameToSearch').val().length === 0) {\n            return;\n        }\n\n        if (searchRequestXhr) {\n            searchRequestXhr.abort();\n        }\n\n        const searchingFor = $('#nameToSearch').val().trim() + ' on ' + $('#providedIndexer option:selected').text() + ' in ' + $('#indexerLangSelect').val();\n        $('#searchResults').empty().html('<img id=\"searchingAnim\" src=\"images/loading32' + MEDUSA.config.themeSpinner + '.gif\" height=\"32\" width=\"32\" /> searching ' + searchingFor + '...');\n\n        searchRequestXhr = $.ajax({\n            url: 'addShows/searchIndexersForShowName',\n            data: {\n                search_term: $('#nameToSearch').val().trim(), // eslint-disable-line camelcase\n                lang: $('#indexerLangSelect').val(),\n                indexer: $('#providedIndexer').val()\n            },\n            timeout: parseInt($('#indexer_timeout').val(), 10) * 1000,\n            dataType: 'json',\n            error() {\n                $('#searchResults').empty().html('search timed out, try again or try another indexer');\n            }\n        }).done(data => {\n            let firstResult = true;\n            let resultStr = '<fieldset>\\n<legend class=\"legendStep\">Search Results:</legend>\\n';\n            let checked = '';\n\n            if (data.results.length === 0) {\n                resultStr += '<b>No results found, try a different search.</b>';\n            } else {\n                $.each(data.results, (index, obj) => {\n                    if (firstResult) {\n                        checked = ' checked';\n                        firstResult = false;\n                    } else {\n                        checked = '';\n                    }\n\n                    const whichSeries = obj.join('|');\n                    const anonRedirect = MEDUSA.config.anonRedirect || '';\n\n                    resultStr += '<input type=\"radio\" id=\"whichSeries\" name=\"whichSeries\" value=\"' + whichSeries.replace(/\"/g, '') + '\"' + checked + ' /> ';\n                    if (data.langid && data.langid !== '' && obj[1] === 1) {\n                        // For now only add the language id to the tvdb url, as the others might have different routes.\n                        resultStr += '<a href=\"' + anonRedirect + obj[2] + obj[3] + '&lid=' + data.langid + '\" onclick=\"window.open(this.href, \\'_blank\\'); return false;\" ><b>' + obj[4] + '</b></a>';\n                    } else {\n                        resultStr += '<a href=\"' + anonRedirect + obj[2] + obj[3] + '\" onclick=\"window.open(this.href, \\'_blank\\'); return false;\" ><b>' + obj[4] + '</b></a>';\n                    }\n\n                    if (obj[5] !== null) {\n                        const startDate = new Date(obj[5]);\n                        const today = new Date();\n                        if (startDate > today) {\n                            resultStr += ' (will debut on ' + obj[5] + ' on ' + obj[6] + ')';\n                        } else {\n                            resultStr += ' (started on ' + obj[5] + ' on ' + obj[6] + ')';\n                        }\n                    }\n\n                    if (obj[0] !== null) {\n                        resultStr += ' [' + obj[0] + ']';\n                    }\n\n                    resultStr += '<br>';\n                });\n                resultStr += '</ul>';\n            }\n            resultStr += '</fieldset>';\n            $('#searchResults').html(resultStr);\n            updateSampleText();\n            myform.loadsection(0); // eslint-disable-line no-use-before-define\n        });\n    }\n\n    $('#searchName').on('click', () => {\n        searchIndexers();\n    });\n\n    if ($('#nameToSearch').length !== 0 && $('#nameToSearch').val().length !== 0) {\n        $('#searchName').click();\n    }\n\n    // @TODO: When switching to Vue - Don't forget about that generateBlackWhiteList...\n    $('#addShowButton').click(() => {\n        /*\n        // If they haven't picked a show don't let them submit\n        if (!$('input:radio[name=\"whichSeries\"]:checked').val() && $('input:hidden[name=\"whichSeries\"]').val().length === 0) {\n            alert('You must choose a show to continue'); // eslint-disable-line no-alert\n            return false;\n        }\n        */\n        generateBlackWhiteList(); // eslint-disable-line no-undef\n        // The submit is handled by Vue\n        // $('#addShowForm').submit();\n    });\n\n    /* JQuery Form to Form Wizard- (c) Dynamic Drive (www.dynamicdrive.com)\n    *  This notice MUST stay intact for legal use\n    *  Visit http://www.dynamicdrive.com/ for this script and 100s more. */\n\n    function goToStep(num) {\n        $('.step').each(function () {\n            if ($.data(this, 'section') + 1 === num) {\n                $(this).click();\n            }\n        });\n    }\n\n    $('#nameToSearch').focus();\n\n    // @TODO we need to move to real forms instead of this\n    const myform = new formtowizard({ // eslint-disable-line new-cap, no-undef\n        formid: 'addShowForm',\n        revealfx: ['slide', 500],\n        oninit() {\n            updateSampleText();\n            if ($('input:hidden[name=whichSeries]').length !== 0 && $('#fullShowPath').length !== 0) {\n                goToStep(3);\n            }\n        }\n    });\n\n    $(document.body).on('change', '#rootDirText', updateSampleText);\n    $('#searchResults').on('change', '#whichSeries', updateSampleText);\n\n    $('#nameToSearch').keyup(event => {\n        if (event.keyCode === 13) {\n            $('#searchName').click();\n        }\n    });\n\n    $('#anime').change(() => {\n        updateSampleText();\n        myform.loadsection(2);\n    });\n\n    $(document.body).on('change', 'select[name=\"quality_preset\"]', () => {\n        setTimeout(() => myform.loadsection(2), 100);\n    });\n\n    $('#rootDirs').on('change', () => {\n        updateSampleText();\n    });\n};\n\n},{}]},{},[1]);\n"],"file":"new-show.js"}