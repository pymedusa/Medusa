!function(e){"use strict";let t,o;e.Browser={defaults:{title:"Choose Directory",url:"browser/",autocompleteURL:"browser/complete",includeFiles:0,showBrowseButton:!0}};let i=null;function l(a,n,s){o!==a&&(o=a,i&&i.abort(),t.dialog("option","dialogClass","browserDialog busy"),t.dialog("option","closeText",""),i=e.getJSON(n,{path:a,includeFiles:s},(i=>{t.empty();const a=i[0];let r=0,c=null;i=e.grep(i,(()=>0!=r++)),e('<input type="text" class="form-control input-sm">').val(a.currentPath).on("keypress",(e=>{13===e.which&&l(e.target.value,n,s)})).appendTo(t).fileBrowser({showBrowseButton:!1}).on("autocompleteselect",((e,t)=>{l(t.item.value,n,s)}));const u=e("<ul>").appendTo(t);e.each(i,((t,i)=>{c=e('<a href="javascript:void(0)">').on("click",(()=>{i.isFile?(o=i.path,e('.browserDialog .ui-button:contains("Ok")').click()):l(i.path,n,s)})).text(i.name),i.isFile?c.prepend('<span class="ui-icon ui-icon-blank"></span>'):c.prepend('<span class="ui-icon ui-icon-folder-collapsed"></span>').on("mouseenter",(function(){e("span",this).addClass("ui-icon-folder-open")})).on("mouseleave",(function(){e("span",this).removeClass("ui-icon-folder-open")})),c.appendTo(u)})),e("a",u).wrap('<li class="ui-state-default ui-corner-all">'),t.dialog("option","dialogClass","browserDialog")})))}e.fn.nFileBrowser=function(i,a){a=e.extend({},e.Browser.defaults,a),t?t.dialog("option","title",a.title):t=e('<div class="fileBrowserDialog" style="display:hidden"></div>').appendTo("body").dialog({dialogClass:"browserDialog",title:a.title,position:{my:"center top",at:"center top+100",of:window},minWidth:Math.min(e(document).width()-80,650),height:Math.min(e(document).height()-120,e(window).height()-120),maxHeight:Math.min(e(document).height()-120,e(window).height()-120),maxWidth:e(document).width()-80,modal:!0,autoOpen:!1}),t.dialog("option","buttons",[{text:"Ok",class:"btn-medusa",click(){i(o,a),e(this).dialog("close")}},{text:"Cancel",class:"btn-medusa",click(){e(this).dialog("close")}}]);let n="";return a.initialDir&&(n=a.initialDir),l(n,a.url,a.includeFiles),t.dialog("open"),!1},e.fn.fileBrowser=function(t){if((t=e.extend({},e.Browser.defaults,t)).field=e(this),t.field.autocomplete&&t.autocompleteURL){let o="";t.field.autocomplete({position:{my:"top",at:"bottom",collision:"flipfit"},source(i,l){o=e.ui.autocomplete.escapeRegex(i.term,t.includeFiles),e.ajax({url:t.autocompleteURL,data:i,dataType:"json"}).done((t=>{const i=new RegExp("^"+o,"i"),a=e.grep(t,(e=>i.test(e)));l(a)}))},open(){e(".ui-autocomplete li.ui-menu-item a").removeClass("ui-corner-all")}}).data("ui-autocomplete")._renderItem=function(t,i){let l=i.label;const a=new RegExp("(?![^&;]+;)(?!<[^<>]*)("+o+")(?![^<>]*>)(?![^&;]+;)","gi");return l=l.replace(a,(e=>"<b>"+e+"</b>")),e("<li></li>").data("ui-autocomplete-item",i).append('<a class="nowrap">'+l+"</a>").appendTo(t)}}let o,i=!1;try{i=Boolean(localStorage.getItem)}catch(e){console.log(e)}i&&t.key&&(o=localStorage["fileBrowser-"+t.key]),t.key&&0===t.field.val().length&&o&&t.field.val(o);const l=(e,t)=>{t.field.val(e),i&&t.key&&(localStorage["fileBrowser-"+t.key]=e)};return t.field.addClass("fileBrowserField"),t.showBrowseButton&&t.field.after(e('<input type="button" value="Browse&hellip;" class="btn-medusa btn-inline fileBrowser">').on("click",(function(){const i=t.field.val()||t.key&&o||"",a=e.extend({},t,{initialDir:i});return e(this).nFileBrowser(l,a),!1}))),t.field}}(jQuery);