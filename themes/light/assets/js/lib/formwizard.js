function formtowizard(e){this.setting=jQuery.extend({persistsection:!1,revealfx:["slide",500],oninit:function(){},onpagechangestart:function(){}},e),this.currentsection=-1,this.init(this.setting)}formtowizard.prototype={createfieldsets:function(e,t){e.find("fieldset.sectionwrap").removeClass("sectionwrap");for(var s=e.find(":first-child"),i=0;i<t.length;i++){var n=s.nextUntil("#"+t[i].breakafter+", *[name="+t[i].breakafter+"]").andSelf();n.add(n.next()).wrapAll('<fieldset class="sectionwrap" />'),s=e.find("fieldset.sectionwrap").eq(i).prepend('<legend class="legendStep">'+t[i].legend+"</legend>").next()}},loadsection:function(e,t){var s=this,i=t||this.setting.onpagechangestart(jQuery,this.currentsection,this.sections.$sections.eq(this.currentsection));(i=!1!==i,!t&&this.setting.validate)&&(!1===this.validate(this.currentsection)&&(i=!1));var n="prev"==e?this.currentsection-1:"next"==e?this.currentsection+1:parseInt(e);(n=n<0?this.sections.count-1:n>this.sections.count-1?0:n)<this.sections.count&&i&&(this.$thesteps.eq(this.currentsection).addClass("disabledstep").end().eq(n).removeClass("disabledstep"),"slide"==this.setting.revealfx[0]?(this.sections.$sections.css("visibility","visible"),this.sections.$outerwrapper.stop().animate({height:this.sections.$sections.eq(n).outerHeight()},this.setting.revealfx[1]),this.sections.$innerwrapper.stop().animate({left:-n*this.maxfieldsetwidth},this.setting.revealfx[1],(function(){s.sections.$sections.each((function(e){e!=n&&s.sections.$sections.eq(e).css("visibility","hidden")}))}))):"fade"==this.setting.revealfx[0]?this.sections.$sections.eq(this.currentsection).hide().end().eq(n).fadeIn(this.setting.revealfx[1],(function(){document.all&&this.style&&this.style.removeAttribute&&this.style.removeAttribute("filter")})):this.sections.$sections.eq(this.currentsection).hide().end().eq(n).show(),this.paginatediv.$status.text("Page "+(n+1)+" of "+this.sections.count),this.paginatediv.$navlinks.css("visibility","visible"),0===n?this.paginatediv.$navlinks.eq(0).css("visibility","hidden"):n==this.sections.count-1&&this.paginatediv.$navlinks.eq(1).css("visibility","hidden"),this.setting.persistsection&&formtowizard.routines.setCookie(this.setting.formid+"_persist",n),this.currentsection=n)},addvalidatefields:function(){var e,t=jQuery,s=this.setting,i=this.$theform.get(0);e=s.validate;for(var n=0;n<e.length;n++){var a=i.elements[e[n]];if(a){var o=t(a).parents("fieldset.sectionwrap:eq(0)");1==o.length&&o.data("elements").push(a)}}},validate:function(e){var t=this.sections.$sections.eq(e).data("elements"),s=!0,i=["Please fill out the following fields:\n"];function n(e){s=!1,i.push("- "+(e.id||e.name))}for(var a=0;a<t.length;a++)if(/(text)/.test(t[a].type)&&""===t[a].value)n(t[a]);else if(!/(select)/.test(t[a].type)||-1!=t[a].selectedIndex&&""!==t[a].options[t[a].selectedIndex].text){if(void 0===t[a].type&&t[a].length>0){for(var o=!1,r=0;r<t[a].length;r++)if(!0===t[a][r].checked){o=!0;break}o||n(t[a][0])}}else n(t[a]);return s||alert(i.join("\n")),s},init:function(e){var t=this;jQuery((function(s){var i=s("#"+e.formid);0===i.length&&(i=s("form[name="+e.formid+"]")),e.manualfieldsets&&e.manualfieldsets.length>0&&t.createfieldsets(i,e.manualfieldsets);var n=s('<div class="stepsguide" />'),a=i.find("fieldset.sectionwrap").hide();"slide"==e.revealfx[0]&&($sectionswrapper=s('<div style="position:relative;overflow:hidden;"></div>').insertBefore(a.eq(0)),$sectionswrapper_inner=s('<div style="position:absolute;left:0;top:0;"></div>'));var o=a.eq(0).outerWidth();a.slice(1).each((function(e){o=Math.max(s(this).outerWidth(),o)})),o+=2,t.maxfieldsetwidth=o,a.each((function(i){var a=s(this);"slide"==e.revealfx[0]&&a.data("page",i).css({position:"absolute",top:0,left:o*i}).appendTo($sectionswrapper_inner),a.data("elements",[]),s('<div class="step disabledstep" />').data("section",i).html("Step "+(i+1)+'<div class="smalltext">'+a.find("legend:eq(0)").text()+"<p></p></div>").appendTo(n).click((function(){t.loadsection(s(this).data("section"))}))})),"slide"==e.revealfx[0]&&($sectionswrapper.width(o),$sectionswrapper.append($sectionswrapper_inner)),i.prepend(n);var r=n.find("div.step"),c=s('<div class="formpaginate" style="overflow:hidden;"><span class="prev" style="float:left">Prev</span> <span class="status">Step 1 of </span> <span class="next" style="float:right">Next</span></div>');i.append(c),t.$theform=i,"slide"==e.revealfx[0]?(t.sections={$outerwrapper:$sectionswrapper,$innerwrapper:$sectionswrapper_inner,$sections:a,count:a.length},t.sections.$sections.show()):t.sections={$sections:a,count:a.length},t.$thesteps=r,t.paginatediv={$main:c,$navlinks:c.find("span.prev, span.next"),$status:c.find("span.status")},t.paginatediv.$main.click((function(e){/(prev)|(next)/.test(e.target.className)&&t.loadsection(e.target.className)}));var l=e.persistsection?formtowizard.routines.getCookie(e.formid+"_persist"):0;t.loadsection(l||0,!0),t.setting.oninit(s,l,a.eq(l)),e.validate&&(t.addvalidatefields(),t.$theform.submit((function(){for(var e=!0,s=0;s<t.sections.count;s++)if(!t.validate(s)){t.loadsection(s,!0),e=!1;break}return e})))}))}},formtowizard.routines={getCookie:function(e){var t=new RegExp(e+"=[^;]+","i");return document.cookie.match(t)?document.cookie.match(t)[0].split("=")[1]:null},setCookie:function(e,t){document.cookie=e+"="+t+";path=/"}};